<template>
<div class="jy_act_scroll jy_act_blindPrize jy_act_blindNew">
	<div class="main jy_all_top jy_act jy_act_new jy_act_blind">
		<div class="page_1 page1">
			<div class="horizontalScroll_1">
				<div class="page_2 s1">
					<div class="header">
						<div class="top">
							<Back class="left" v-if="!$store.state.isWeixin"><i class="iconfont">&#xe613;</i></Back><div class="right">
								<a @click.shop="qcode"><i class="iconfont">&#xe60e;</i></a><!--<a><i class="iconfont">&#xe638;</i></a>--><a @click.stop="exit('actInfo',{id:datingId,type:'blindDate'})"><i class="iconfont">&#xe92f;</i></a><a v-if="!$store.state.isBrowser" @click.stop="exit('registrationActivity')"><i class="iconfont">&#xe7de;</i></a>
							</div><p>{{owner&&owner.datingTitle}}</p>
						</div>
					</div>
					<div class="jy_act_top" v-if="owner&&chatRoomInfo">
						<template v-if="isManage">
							<ul class="jy_act_step_btn">
								<li :class="{cur:chatRoomInfo.number==1&&chatRoomInfo.status==2}"><i @click.stop="datingStepButton(1,2)" class="bd_btn_bg_2 bd_btn_1"></i><p>双向配</p></li>
								<li :class="{cur:chatRoomInfo.number==2&&chatRoomInfo.status==1}"><i @click.stop="datingStepButton(2,1)" class="bd_btn_bg_5 bd_btn_2"></i><p>推女方</p></li>
								<li :class="{cur:chatRoomInfo.number==2&&chatRoomInfo.status==2}"><i @click.stop="datingStepButton(2,2)" class="bd_btn_bg_5 bd_btn_3"></i><p>男求配</p></li>
								<li :class="{cur:chatRoomInfo.number==3&&chatRoomInfo.status==1}"><i @click.stop="datingStepButton(3,1)" class="bd_btn_bg_1 bd_btn_4"></i><p>推男方</p></li>
								<li :class="{cur:chatRoomInfo.number==3&&chatRoomInfo.status==2}"><i @click.stop="datingStepButton(3,2)" class="bd_btn_bg_1 bd_btn_5"></i><p>女求配</p></li>
							</ul>
							<ul class="jy_act_step_btn">
								<li :class="{cur:chatRoomInfo.number==5&&chatRoomInfo.status==1}"><i @click.stop="datingStepButton(5,1,1)" class="bd_btn_bg_4 bd_btn_7"></i><p>抽对象</p></li>
								<li :class="{cur:chatRoomInfo.number==6&&chatRoomInfo.status==1}"><i @click.stop="datingStepButton(6,1,2)" class="bd_btn_bg_4 bd_btn_8"></i><p>随机抽</p></li>
								<li class="on"><i @click.stop="showLuck=true" class="bd_btn_bg_4 bd_btn_9"></i><p>幸运签</p></li>
								<li class="on"><i @click.stop="showMsg=true,msgUser={name:'发广播给所有人',userId:'',img:owner.jiaoyouUser.headimgAttachmentId}" class="bd_btn_bg_3 bd_btn_6"></i><p>发广播</p></li>
							</ul>
						</template>
						<template v-else>
							<div class="jy_act_top_user">
								<i class="jy_act_top_user_img" :style="'background-image:url('+$utils.getFullPath($store.state.userInfo.headimgAttachmentId)+')'"><em v-if="isSign">{{getSex($store.state.userInfo.sex)+isSign+"号"}}</em></i>
								<p class="jy_act_top_user_text">{{$store.state.userInfo.aliasName}}<br>有{{myLove.length}}人选我<br><!--，<a>点击查看</a>--></p>
								<ul class="jy_act_step_btn">
									<li class="on"><i @click.stop="showMsg=true,msgUser={name:'给主持人留言',userId:owner.jiaoyouUser.id,img:owner.jiaoyouUser.headimgAttachmentId}" class="bd_btn_bg_3 bd_btn_13"></i><p>留言</p></li>
									<li class="on"><i @click.stop="userRefresh" class="bd_btn_bg_5 bd_btn_12"></i><p>刷新</p></li>
									<li class="on" @click="toLink" v-if="chatRoomInfo&&((chatRoomInfo.number==5&&!myMathch)||chatRoomInfo.number==6)"><i class="bd_btn_bg_4 bd_btn_8"></i><p>抽奖</p></li>
								</ul>
								<ul class="jy_act_top_user_tongji">
									<li>{{$store.state.userInfo.userExt.newFanCount||0}}<em>关注我</em></li>
									<li>{{$store.state.userInfo.userExt.vistorCount||0}}<em>查看我</em></li>
									<li>{{$store.state.userInfo.userExt.beLikeCount||0}}<em>好感</em></li>
									<!--<li>23234<em>点赞我</em></li>	-->
								</ul>
							</div>
						</template>
						<template v-if="chatRoomInfo">
							<!--<p class="jy_act_bl_tip" >当前匹配成功{{currMatchUsers.length}}对<i class="jy_act_newPeople">{{baomingUser&&baomingUser.length||owner.enrollCount||0}}</i></p>-->
							<p class="jy_act_bl_tip" v-if="isManage">报名人数：{{baomingUser&&baomingUser.length||owner.enrollCount||0}}人,签到人数:{{chatRoomInfo.baoMingCount||0}},男:{{chatRoomInfo.lookOnCount}},女:{{chatRoomInfo.baoMingCount-chatRoomInfo.lookOnCount}},已匹配:{{currMatchUsers.length}}对,剩余:(男:{{chatRoomInfo.lookOnCount-currMatchUsers.length}},女:{{chatRoomInfo.baoMingCount-chatRoomInfo.lookOnCount-currMatchUsers.length}});
							<p class="jy_act_bl_tip" v-else>已匹配：{{curMatch.length}}对，报名人数：{{baomingUser&&baomingUser.length||owner.enrollCount||0}}人</p>
						</template>
					</div>
					<div class="jy_act_mid" :class="{jy_act_mid_manage:isManage}">
						<div class="jy_act_mid_con">
							<div v-if="isManage" class="jy_act_bl_scroll ">
								<div class="jy_bd_menu">
									<i :class="{cur:phListType==4}" @click.stop="phListType=4">人气排行</i>
									<i :class="{cur:phListType==1}" @click.stop="phListType=1">好感排行</i>
									<i :class="{cur:phListType==2}" @click.stop="phListType=2">留言</i>
									<i :class="{cur:phListType==3}" @click.stop="phListType=3">匹配结果</i>
								</div>
								<ul v-if="phListType==1"  class="jy_bd_menu_list">
									<li v-for="item,index in likePhList">
										<i class="jy_bd_menu_img" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"><em v-if="item.ext">{{item.ext&&item.ext.extInt}}</em></i>
										<h4>{{item.candidateName}}</h4>
										<p><i class="jy_auth_age" :class="{jy_auth_age_man:item.candidateSex==2}">{{item.candidateSex==1?'&#xe64a;':'&#xe605;'}}{{item.jiaoyouUser.age}}</i></p>
										<em class="jy_bd_menu_num" v-if="item.beLikeCount">好感数：{{item.beLikeCount}}</em>
									</li>
								</ul>
								<ul v-else-if="phListType==4" class="jy_bd_menu_list">
									<li v-for="item,index in taskList">
										<i class="jy_bd_menu_img" :style="'background-image:url('+$utils.getFullPath(item.headimgAttachmentId)+')'"><em v-if="item.extInt">{{item.extInt}}</em></i>
										<h4>{{item.aliasName}}</h4>
										<p><i class="jy_auth_age" :class="{jy_auth_age_man:item.sex==2}">{{item.sex==1?'&#xe64a;':'&#xe605;'}}{{item.age}}</i></p>
										<em class="jy_bd_menu_num">人气乾坤值：{{item.sumMoney}}</em>
									</li>
								</ul>
								<ul v-else-if="phListType==2" class="jy_bd_menu_biaobai">
									<li v-for="item,index in userMsg">
										<i class="jy_bd_menu_img" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"><em v-if="item.signInCode">{{item.signInCode}}</em></i>
										<h4>{{item.jiaoyouUser.aliasName}}<i class="jy_auth_age" :class="{jy_auth_age_man:item.jiaoyouUser.sex==2}">{{item.jiaoyouUser.sex==1?'&#xe64a;':'&#xe605;'}}{{item.jiaoyouUser.age}}</i></h4>
										<p>{{item.content}}</p>
									</li>						
								</ul>
								<ul v-else-if="phListType==3" class="jy_bd_menu_result">
									<li v-for="item,index in allMatchUsers" :data-num="index+1">
										<div class="jy_bd_menu_c">
											<span class="jy_bd_menu_result_l">
												<i :style="'background-image:url('+$utils.getFullPath(item[0].headimg)+')'"><em :class="{cur:item[0].sex==2}">{{item[0].extInt}}</em></i>
												<p>{{item[0].name}}</p>
											</span>
											<span class="jy_bd_menu_result_r">
												<i :style="'background-image:url('+$utils.getFullPath(item[1].headimg)+')'"><em :class="{cur:item[1].sex==2}">{{item[1].extInt}}</em></i>
												<p>{{item[1].name}}</p>
											</span>
											<em class="jy_bd_menu_result_type" :class="{cur2:item[0].number==2,cur3:item[0].number==3}" v-if="item[0].number==1||item[0].number==2||item[0].number==3||item[0].number==5">{{item[0].number==1?'双向配':item[0].number==2?'男求配':item[0].number==3?'女求配':item[0].number==5?'抽对象':''}}</em>
										</div>
										<i v-if="item[0].status==0" class="jy_bd_menu_btn" @click.stop="publishMatch(item)">公布</i>
										<i v-else-if="item[0].status==1" class="jy_bd_menu_btn off">已公布</i>
									</li>
								</ul>
							</div>
							<div v-else class="jy_act_bl_scroll">
								<div class="jy_act_mid_top">
									<div class="jy_bl_jy_act_mid_top_r">
										<!--<i>筛选</i>-->
										<i @click.stop="userStyle+=1">&#xe687;</i>
									</div>
									<div class="jy_bl_Choose_search"><input type="search" v-model="searchKey" @search="search(false)" placeholder="搜索序号、昵称或年龄"></div>
								</div>
								<ul class="jy_bd_user" :class="'userStyle_'+(userStyle%2)">
									<!-- 推女方/推男方 -->
									<template v-if="chatRoomInfo&&!myMathch&&chatRoomInfo.status==1&&myLove.length>0&&((chatRoomInfo.number==2&&$store.state.userInfo.sex==1)||(chatRoomInfo.number==3&&$store.state.userInfo.sex==2))">
										<!--<template v-if="myLove.length>0">-->
											<li v-for="item,index in myLove" v-if="$store.state.userInfo.id!=item.userId">
												<i class="jy_bd_user_img" @click.stop="showSelectUser(item.userId)" :style="'background-image:url('+$utils.getFullPath(item.headimg)+')'">
													<span>{{item.extInt?getSex(item.sex)+item.extInt+"号":"待签到"}}</span>
													<em class="jy_bd_com" :class="{cur:msgLength[item.userId]}" @click.stop="showMsg=true,msgUser={name:item.name,userId:item.userId,img:item.headimg}"></em>
													<em class="chooseMe">接受我</em>
												</i>
												<p class="jy_bl_select_ico"><i class="jy_auth_age" :class="{jy_auth_age_man:item.sex==2}">{{item.sex==1?'&#xe64a;':'&#xe605;'}}{{item.age}}</i>{{item.name}}</p>
												
											</li>
											<li v-for="item,index in notLoveList" v-if="$store.state.userInfo.id!=item.jiaoyouUser.id">
												<i class="jy_bd_user_img" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'">
													<span>{{item.ext&&item.ext.extInt?getSex(item.candidateSex)+item.ext.extInt+"号":"待签到"}}</span>
													<template v-if="isSign&&item.ext&&item.ext.extInt&&item.candidateSex!=$store.state.userInfo.sex">
													<em class="jy_bd_com" :class="{cur:msgLength[item.jiaoyouUser.id]}" @click.stop="showMsg=true,msgUser={name:item.jiaoyouUser.aliasName,userId:item.jiaoyouUser.id,img:item.jiaoyouUser.headimgAttachmentId}"></em>
													</template>
												</i>
												<p class="jy_bl_select_ico"><i class="jy_auth_age" :class="{jy_auth_age_man:item.candidateSex==2}">{{item.candidateSex==1?'&#xe64a;':'&#xe605;'}}{{item.jiaoyouUser.age}}</i>{{item.jiaoyouUser.aliasName}}</p>
												
											</li>
											
										<!--</template>
										<li v-else>暂无</li>-->
									</template>
									<template v-else-if="searchList.length>0||searchKey!=''">
										<template v-if="searchList.length>0">
											<li v-for="item,index in searchList" v-if="$store.state.userInfo.id!=item.jiaoyouUser.id" @click.stop="$store.state.userInfo.sex!=item.candidateSex?getUserInfo(item.jiaoyouUser.id):''">
												<i class="jy_bd_user_img" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'">
													<template v-if="isSign&&item.ext&&item.ext.extInt&&item.candidateSex!=$store.state.userInfo.sex">
															<em class="jy_bd_choose" v-if="item.jiaoyouUser.isLike!=2&&!myMathch" :class="{cur:item.jiaoyouUser.isLike==3||item.jiaoyouUser.isLike==1}" @click.stop="saveSingleLike(index)"></em>
													
															<em class="jy_bd_love" :class="{cur:item.jiaoyouUser.isGood}" @click.stop="myFeel(index)"></em>
														
														<em v-if="(myMathch&&myMathch.userId==item.jiaoyouUser.id)||!myMathch" class="jy_bd_com" :class="{cur:msgLength[item.jiaoyouUser.id]}" @click.stop="showMsg=true,msgUser={name:item.jiaoyouUser.aliasName,userId:item.jiaoyouUser.id,img:item.jiaoyouUser.headimgAttachmentId}"></em>
													</template>
													<span>{{item.ext&&item.ext.extInt?getSex(item.candidateSex)+item.ext.extInt+"号":"待签到"}}</span>
												</i>
												<p class="jy_bl_select_ico"><i class="jy_auth_age" :class="{jy_auth_age_man:item.candidateSex==2}">{{item.candidateSex==1?'&#xe64a;':'&#xe605;'}}{{item.jiaoyouUser.age}}</i>{{item.candidateName}}</p>
											</li>
										</template>
										<li v-else>暂无结果</li>
									</template>
									<template v-else>
										<li v-for="item,index in baomingUser" v-if="$store.state.userInfo.id!=item.jiaoyouUser.id" @click.stop="$store.state.userInfo.sex!=item.candidateSex?getUserInfo(item.jiaoyouUser.id):''">
											<i class="jy_bd_user_img" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'">
												<template v-if="isSign&&item.ext&&item.ext.extInt&&item.candidateSex!=$store.state.userInfo.sex">	
													<em class="jy_bd_choose" v-if="item.jiaoyouUser.isLike!=2&&!myMathch" :class="{cur:item.jiaoyouUser.isLike==3||item.jiaoyouUser.isLike==1}" @click.stop="saveSingleLike(index)"></em>
													<em class="jy_bd_love" :class="{cur:item.jiaoyouUser.isGood}" @click.stop="myFeel(index)"></em>
													<em v-if="(myMathch&&myMathch.userId==item.jiaoyouUser.id)||!myMathch" class="jy_bd_com" :class="{cur:msgLength[item.jiaoyouUser.id]}" @click.stop="showMsg=true,msgUser={name:item.jiaoyouUser.aliasName,userId:item.jiaoyouUser.id,img:item.jiaoyouUser.headimgAttachmentId}"></em>
												</template>
												<span>{{item.ext&&item.ext.extInt?getSex(item.candidateSex)+item.ext.extInt+"号":"待签到"}}</span>
											</i>
											<p class="jy_bl_select_ico"><i class="jy_auth_age" :class="{jy_auth_age_man:item.candidateSex==2}">{{item.candidateSex==1?'&#xe64a;':'&#xe605;'}}{{item.jiaoyouUser.age}}</i>{{item.candidateName}}</p>
										</li>
									</template>
								</ul>
							</div>
						</div>
					</div>
					<div class="jy_act_bottom" v-if="!isManage">
						<span class="jy_act_bd_btn" :class="{cur:isInPrize}"><i @click.stop="toOpen(1)"></i>允许别人把我抽走<em @click.stop="prizeTip">&#xe682;</em></span>
						<!--<span class="jy_act_bd_btn" :class="{cur:isOpenInfo}"><i @click.stop="toOpen(2)"></i>公开资料<em>&#xe682;</em></span>-->
					</div>
				</div>
				<div class="page_2 s2">
					<div class="header">
						<div class="top">
							<div class="right">
								<a @click.stop="exit('actInfo',{id:datingId,type:'blindDate'})"><i class="iconfont">&#xe92f;</i></a>
							</div><p>{{isManage?'相亲结果':owner&&owner.datingTitle}}</p>
						</div>
					</div>
					<template v-if="isManage">
						<p class="jy_act_s2_re"><a v-for="item,index in curResultMenu" :class="{cur:curResult==index}" @click.stop="curResult=index">{{item}}</a></p>
						<dl class="jy_act_result">
							<dt>
								<p class="jy_act_result_tit">{{curResult==0?(allMatchUsers?'匹配结果('+currMatchUsers.length+'对)':'暂无匹配'):curResult==1?(prizeUser?'抽奖结果('+prizeUserList.length+(luckuser?'+'+luckuser.length:'')+'人)':luckuser?'单独抽奖'+'('+luckuser.length+'人)':'暂无结果'):''}}</p>
								
								<div class="jy_act_result_menu" v-if="curResult==1&&(prizeUser||luckuser)"><i>
									<a v-if="luckuser" @click.stop="curPrize='Alone'" :class="{cur:curPrize=='Alone'||!prizeUser}">抽奖(单独)({{luckuser.length}})</a></i>
								</div>
							</dt>
							<dd>
								<div class="jy_act_bl_reslist" v-if="curResult==0&&allMatchUsers">
									<ul>
										<li v-for="item,index in allMatchUsers">
											<div class="jy_act_bl_reslist_l">
												<i :style="'background-image:url('+$utils.getFullPath(item[0].headimg)+')'"></i>
												<p>{{"("+getSex(item[0].sex)+item[0].extInt+"号)"+item[0].name}}</p>
											</div>
											<div class="jy_act_bl_reslist_r">
												<i :style="'background-image:url('+$utils.getFullPath(item[1].headimg)+')'"></i>
												<p>{{"("+getSex(item[1].sex)+item[1].extInt+"号)"+item[1].name}}</p>
											</div>
										</li>
									</ul>
								</div>
								<ul v-else-if="curResult==1&&(prizeUser||luckuser)" class="jy_act_bl_rlist">
									<template v-if="prizeUser&&curPrize!='Alone'">
										<li v-for="item,index in prizeUser[curPrize]">
											<i :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"></i>
											<p>{{"("+getSex(item.candidateSex)+item.ext.extInt+"号)"+item.jiaoyouUser.aliasName}}</p>
										</li>
									</template>
									<template v-else-if="luckuser">
										<li v-for="item,index in luckuser">
											<i :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"></i>
											<p>{{"("+getSex(item.candidateSex)+item.ext.extInt+"号)"+item.jiaoyouUser.aliasName}}</p>
										</li>
									</template>
								</ul>	
							</dd>
						</dl>
					</template>
					<template v-else>
						<div class="jy_act_mid">
							<div class="jy_act_mid_con">
								<div class="jy_act_bl_scroll ">
									<div class="jy_bd_menu">
										<i :class="{cur:phListType==4}" @click.stop="phListType=4">人气排行</i>
										<i :class="{cur:phListType==1}" @click.stop="phListType=1">好感排行</i>
										<i :class="{cur:phListType==2}" @click.stop="phListType=2">主持人有话说</i>
										<i :class="{cur:phListType==3}" @click.stop="phListType=3">匹配结果</i>
									</div>
									<ul v-if="phListType==1"  class="jy_bd_menu_list">
										<li v-for="item,index in likePhList" v-if="index<10&&item.beLikeCount">
											<i class="jy_bd_menu_img" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"><em>{{item.ext&&item.ext.extInt}}</em></i>
											<h4>{{item.candidateName}}</h4>
											<p><i class="jy_auth_age" :class="{jy_auth_age_man:item.candidateSex==2}">{{item.candidateSex==1?'&#xe64a;':'&#xe605;'}}{{item.jiaoyouUser.age}}</i></p>
											<em class="jy_bd_menu_num" v-if="item.beLikeCount">好感数：{{item.beLikeCount}}</em>
										</li>
									</ul>
									<ul v-else-if="phListType==4" class="jy_bd_menu_list">
										<li v-for="item,index in taskList" v-if="index<20">
											<i class="jy_bd_menu_img" :style="'background-image:url('+$utils.getFullPath(item.headimgAttachmentId)+')'"><em v-if="item.extInt">{{item.extInt}}</em></i>
											<h4>{{item.aliasName}}</h4>
											<p><i class="jy_auth_age" :class="{jy_auth_age_man:item.sex==2}">{{item.sex==1?'&#xe64a;':'&#xe605;'}}{{item.age}}</i></p>
											<em class="jy_bd_menu_num">人气乾坤值：{{item.sumMoney}}</em>
										</li>
									</ul>
									<ul v-else-if="phListType==2" class="jy_bd_menu_biaobai">
										<li v-for="item,index in zhuchiMsg">
											<i class="jy_bd_menu_img" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"></i>
											<h4>主持人</h4>
											<p>{{item.content}}</p>
										</li>								
									</ul>
									<ul v-else-if="phListType==3" class="jy_bd_menu_result">
										<li v-for="item,index in allMatchUsers" :data-num="index+1">
											<div class="jy_bd_menu_c jy_bd_menu_c2">
												<span class="jy_bd_menu_result_l">
													<i :style="'background-image:url('+$utils.getFullPath(item[0].headimg)+')'"><em :class="{cur:item[0].sex==2}">{{item[0].extInt}}</em></i>
													<p>{{item[0].name}}</p>
												</span>
												<span class="jy_bd_menu_result_r">
													<i :style="'background-image:url('+$utils.getFullPath(item[1].headimg)+')'"><em :class="{cur:item[1].sex==2}">{{item[1].extInt}}</em></i>
													<p>{{item[1].name}}</p>
												</span>
												<em class="jy_bd_menu_result_type" :class="{cur2:item[0].number==2,cur3:item[0].number==3}" v-if="item[0].number==1||item[0].number==2||item[0].number==3||item[0].number==5">{{item[0].number==1?'双向配':item[0].number==2?'男求配':item[0].number==3?'女求配':item[0].number==5?'抽对象':''}}</em>
											</div>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</template>
				</div>
			</div>
		</div>
	</div>
	<Loading v-if="isloading"></Loading>
	<a class="jy_s1_jt"></a>
	<div v-if="showZy" class="jy_act_zy_prize">
		<p class="jy_act_qy_t">
			<i v-if="!startPrize">{{prizeTime}}秒后自动抽奖</i>
			<em class="jy_act_qy_close" @click.shop="showZy=false">&#xe622;</em>
		</p>
		<Prize @endPrize="endPrize" @prizeRunning="prizeRunning" @toStartPrize="toStartPrize" :startPrize="startPrize" :prizeIndex="prizeIndex"></Prize>
		<!--<p class="jy_act_zy_b"><i><em bgImg="@images/e4.jpg"></em>看天不美   正在抽奖.....</i></p>-->
	</div>
	<div v-show="showVedio" class="vedio-cls">
		<div>
			<span></span>
			<span></span>
			<span></span>
			<span></span>
			<span></span>
		</div>
		<div>松开发送，上滑取消</div>
	</div>
	<div v-transfer-dom>
		<popup v-model="showWin" height="100%" :hide-on-blur=false position="bottom" :popup-style="{zIndex:598}" :should-scroll-top-on-show="true">
		<div class="top_userInfo" v-if="showInfo">
			<userInfo :actDatingId="datingId" :actGetGoodDatingId="datingId" :select="select" @openWin="openWin" @hiddenInfo="hiddenInfo" :userId="userId"></userInfo>
		</div>
		</popup>
	</div>
  <div v-transfer-dom>
    <popup v-model="showPrizeDraw" height="100%" :hide-on-blur=false position="bottom" :popup-style="{zIndex:598}" :should-scroll-top-on-show="true">
      <div v-if="showPrizeDraw&&chatRoomInfo&&(chatRoomInfo.number==5||chatRoomInfo.number==6)" class="top_userInfo" >
        <prizeDraw :actChatNumber="chatRoomInfo.number" :actDatingId="datingId" @hiddenInfo="hiddenPrizeDraw"></prizeDraw>
      </div>
    </popup>
  </div>
	<transition enter-active-class="slideInUp" leave-active-class="slideOutUp">
	  <gift v-show="showGift" :showAnimate="false"  @sendGift="sendGift" :name="title" @close="sendGift" :list="giftList"></gift>
	</transition>
	<transition enter-active-class="slideInUp" leave-active-class="slideOutUp">
	  <gift v-show="showGiftUser" :showAnimate="false"  @sendGift="sendGiftUser" :name="selectUserInfo&&selectUserInfo.aliasName" @close="sendGiftUser" :list="giftList"></gift>
	</transition>
	<div class="ds_flower">
		<!--<div class="flower"></div>-->
		<ul>
		</ul>
	</div>
	<!-- 查看中意我的人的信息(接受她) -->
	<div class="jy_bl_select" v-if="showSelect" @click.stop="showSelect=false">
		<div class="jy_bl_select_con" @click.stop>
			<div class="jy_bl_select_top">
				<p class="jy_bl_select_id"><i @click.stop="showSelect=false">&#xe67c;</i>ID：{{selectUserInfo.jyNumber}}</p>
				<i class="jy_bl_select_img" :style="'background-image:url('+$utils.getFullPath(selectUserInfo.headimgAttachmentId)+')'" @click.stop="getUserInfo(selectUserInfo.id)"></i>
				<p class="jy_bl_select_ico">{{selectUserInfo.aliasName}}<i class="jy_auth_age" :class="{jy_auth_age_man:selectUserInfo.sex==2}">{{selectUserInfo.sex==1?'&#xe64a;':'&#xe605;'}}{{selectUserInfo.age}}</i><i class="jy_xz">{{selectUserInfo.userExt.constellation}}</i></p>
				<p class="jy_bl_select_text">{{selectUserInfo.selfLabel}}</p>
			</div>
			<ul class="jy_bl_select_list">
				<li v-if="selectUserInfo.isGood" class="cur" @click.stop="myFeel('')"><i>&#xe793;</i>有好感</li>
				<li v-else @click.stop="myFeel('')"><i>&#xe793;</i>好感</li>
				<li @click.stop="showGiftUser=true"><i>&#xe6e0;</i>送礼</li>
				<li v-if="selectUserInfo.isFollow==0" @click.stop="followFriend"><i>&#xe642;</i>关注</li>
				<li v-else class="cur"  @click.stop="unfollowFriend"><i>&#xe642;</i>已关注</li>
				<li @click.stop="showMsg=true,msgUser={name:selectUserInfo.aliasName,userId:selectUserInfo.id,img:selectUserInfo.headimgAttachmentId}"><i>&#xe644;</i>对话</li>
			</ul>
			<p class="jy_auth_btn" v-if="chatRoomInfo&&!isMatch&&((chatRoomInfo.number==2&&chatRoomInfo.status==1&&$store.state.userInfo.sex==1)||(chatRoomInfo.number==3&&chatRoomInfo.status==1&&$store.state.userInfo.sex==2))&&(selectUserInfo.isLike==0||selectUserInfo.isLike==3)" @click.stop="marriageAgree">接受{{$store.state.userInfo.sex==2?'她':'他'}}</p>
			<p class="jy_auth_btn" v-else-if="chatRoomInfo&&!isMatch&&((chatRoomInfo.number==2&&chatRoomInfo.status==1&&$store.state.userInfo.sex==1)||(chatRoomInfo.number==3&&chatRoomInfo.status==1&&$store.state.userInfo.sex==2))&&selectUserInfo.isLike==1" @click.stop="cancelLike(getBaomingUserIndex(selectUserInfo.id))">后悔了</p>
			<p class="jy_auth_btn" v-else-if="chatRoomInfo&&!isMatch&&((chatRoomInfo.number==2&&chatRoomInfo.status==1&&$store.state.userInfo.sex==1)||(chatRoomInfo.number==3&&chatRoomInfo.status==1&&$store.state.userInfo.sex==2))&&selectUserInfo.isLike==2">已被抢走</p>
			<!--  isLike :1表示相互匹配，2表示对方已经被别人接受，0表示未匹配 3中意对方-->
		</div>
	</div>
	<div v-transfer-dom>
		<popup v-model="showBaoMingList" class="jy_bl_Choose_wrap" height="100%" :hide-on-blur=false position="bottom" :popup-style="{zIndex:596}" :show-mask="true" :should-scroll-top-on-show="true">
			<dl class="jy_act_activeUser">
				<dt>活动用户<i @click.stop="showPh=false">&#xe7de;</i></dt>
				<dd :class="{jy_act_isUser:!isManage}">
					<ul class="jy_act_activeList jy_act_activeList_abs" v-if="!isManage">
						<li v-for="item,index in baomingUser" :data-num="index+1" v-if="item.jiaoyouUser.id==$store.state.userInfo.id">
							<em class="jy_act_activeJb" :data-prize="getResult(item.jiaoyouUser.id)">{{item.ext&&item.ext.extInt?getSex(item.candidateSex)+item.ext.extInt+"号":"待签到"}}</em>
							<i class="jy_act_activeimg" @click.stop="getUserInfo(item.jiaoyouUser.id)" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"></i>
							<h4>{{item.candidateName}}</h4>
							<p><i class="jy_auth_age" :class="{jy_auth_age_man:item.candidateSex==2}">{{item.candidateSex==1?'&#xe64a;':'&#xe605;'}}{{item.jiaoyouUser.age}}</i></p>
						</li>	
					</ul>
					<ul class="jy_act_activeList">
						<li v-for="item,index in baomingUser" :data-num="index+1">
							<em class="jy_act_activeJb" :data-prize="getResult(item.jiaoyouUser.id)">{{item.ext&&item.ext.extInt?getSex(item.candidateSex)+item.ext.extInt+"号":"待签到"}}</em>
							<i class="jy_act_activeimg" @click.stop="getUserInfo(item.jiaoyouUser.id)" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"></i>
							<h4>{{item.candidateName}}</h4>
							<p><i class="jy_auth_age" :class="{jy_auth_age_man:item.candidateSex==2}">{{item.candidateSex==1?'&#xe64a;':'&#xe605;'}}{{item.jiaoyouUser.age}}</i></p>
						</li>	
					</ul>
				</dd>
			</dl>
		</popup>
	</div>
	<div v-transfer-dom>
		<x-dialog v-model="showQcode" :hide-on-blur=true>
			<div class="jy_act_bl_qcode" v-if="isManage">
				<p>扫描以下二维码签到</p>
				<qrcode class="jy_act_bl_c" :value="signCode.type?JSON.stringify(signCode):signCode"></qrcode>
			</div>
		</x-dialog>
	</div>
	<!-- 已成功匹配的 -->
	<!--<div class="jy_act_fix" v-if="showPP&&!$store.state.isBrowser">
		<div class="jy_act_bl_result">
			<p class="jy_act_bl_retit"><i>匹配结果</i><em @click.stop="showPP=false">&#xe7de;</em></p>
			<div class="jy_act_bl_scroll">
				<div class="jy_act_bl_reslist">
					<ul v-for="val,num in allMatchUsers" :data-num="isManage?'第'+num.replace('num_','')+'轮('+val.length+'对)':'第'+num.replace('num_','')+'轮'">
						<li v-for="item,index in val">
							<div class="jy_act_bl_reslist_l">
								<i :style="'background-image:url('+$utils.getFullPath(item[0].headimg)+')'"></i>
								<p>{{"("+getSex(item[0].sex)+item[0].extInt+"号)"+item[0].name}}</p>
							</div>
							<div class="jy_act_bl_reslist_r">
								<i :style="'background-image:url('+$utils.getFullPath(item[1].headimg)+')'"></i>
								<p>{{"("+getSex(item[1].sex)+item[1].extInt+"号)"+item[1].name}}</p>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>-->
	<!--<div v-transfer-dom>
		<popup v-model="showLuck" class="jy_luck_w" height="100%"  width="100%" :hide-on-blur=false position="left" :popup-style="{zIndex:596}" :show-mask="false" :should-scroll-top-on-show="true">-->
			<Luck v-if="showLuck" :luckList="luckList" @closeLuck="closeLuck" @prizeResult="prizeResult" @moveLuck="moveLuck" @click="endLuck" :startLuck="startLuck" :isManage="isManage" :datingId="datingId"></Luck>
		<!--</popup>
	</div>-->
	<!--<div class="jy_act_zy_prize">
		<myPrize></myPrize>
	</div>-->
	<div class="jy_dia" v-if="showMsg&&(msgUser||isManage)">
		<div class="jy_dia_c">
			<div class="jy_dia_top">
				<em @click.stop="showMsg=false">&#xe7de;</em>
				<i :style="'background-image:url('+$utils.getFullPath(msgUser.img)+')'"></i>{{msgUser.name}}
			</div>
			<ul v-if="isManage" class="jy_act_lt_manage_msg">
				<li v-for="val in manageMsg" @click.stop="sendBroad(val.label)">{{val.label}}</li>
			</ul>
			<ul v-else class="jy_act_lt_list">
					<li v-for="item,index in ownerMsg" :class="item.userId==$store.state.userInfo.id?'jy_lt_right':'jy_lt_left'">
						<i class="jy_lt_img" :style="'background-image:url('+$utils.getFullPath(item.jiaoyouUser.headimgAttachmentId)+')'"></i>
						<div class="jy_lt_msg">{{item.content}}</div>
					</li>
			</ul>	
			<div class="jy_dia_bottom">
				<input v-model="msgTest" type="text" placeholder="说点什么吧">
				<i v-if="isManage" @click.stop="sendBroad('')">发布</i>
				<i v-else @click.stop="sendMessage">发布</i>
			</div>
		</div>
	</div>
</div>
</template>
<script>
	import Loading from '@other/loading.vue';
	import Back from '@other/back.vue';
	import Prize from './prize.vue';
	//import myPrize from './myPrize.vue';
	import userInfo from '../user/userInfo.vue';
	import prizeDraw from '../plugs/prizeDraw';
	import emotion from '@/assets/emotion/emotion';
	import gift from '../plugs/gift';
	import myApi from '@js/flower.js';
	import myTouch from '@js/scrollpage.1.0.3.js';
	import {Popup,TransferDom,XDialog,Qrcode} from 'vux'
	import VoicePlayback from '@/components/plugs/voicePlayback'
	import draggable from 'vuedraggable'
	import { scanQRCode } from '@js/wxjssdk';
	import Media from '@js/voice'
	import Luck from './luck2.vue';
  export default {
    name: 'blindDateNew',
    data () {
		return {
      showPrizeDraw:false,
			activeItem:{},
			showVedio:false,
			touchY:0,
			touchOffset:0,
			voice:false,
			record:false,
			showInfo:false,
			showWin:false,
			datingId:null,
			userId:null,
			isloading:false,
			isActEnd:false,//竞价是否结束
			showPh:false,//活动用户
			showBaoMingList:false,//活动用户弹窗
			showZy:false,//显示抽奖
			dataChats:[],
			UIChatBox:null,
			chatRoomInfo:null,//活动信息{status:"0开始,1结束,2发布,3下一组",number:"轮数,1盲选,2男选女,3女选男,4抽奖"}
			inputBarHeight:0,
			limit:1000,//读取的聊天条数
			chatList:null,//聊天信息
			owner:null,
			showGift:false,
			giftList:[],
			giftEndlist:[],
			title:'',//送礼的对象名
			flower:{},
			prizeRun:false,//抽奖转盘是否在转动
			select:false,//选缘查看用户信息可以选择用户
			showBoard:false,//是否显示聊天框
			//actStatusRes:false,//活动结束后进入不显示结果弹窗的
			onlineUser:[],//在线用户
			showSelect:false,//第二轮接受对象
			chooseList:[],//已经选中的对象
			selectList:[],//现场选择列表
			searchList:[],//搜索的结果
			loveList:[],//好感对象列表
			//showChoose:false,//选择意中人
			searchKey:"",
			listKey:["现场","好感","搜索"],
			listType:0,
			chooseMax:5,//选人的最大数量
			showQcode:false,//显示相亲签到二维码
			showPP:false,
			currMatchUsers:[],//匹配成功的名单
			myLove:[],//中意我的人的列表
			youLove:[],//我中意的人
			selectUserInfo:null,//接收的人的个人信息
			isMatch:false,//是否已经匹配了
			isSelect:false,//是否已经提交了选择(离开现场再进就没效了)
			myMathch:null,//我的匹配对象(可能还没公布的)
			baomingUser:null,//报名人员列表
			showGiftUser:false,
			prizeTime:5,//抽奖倒计时
			prizeTimeout:'',
			startPrize:false,//是否开始抽奖
			prizeIndex:-1,//中奖下标
			isExit:false,
			agreePrize:0,
			isSign:false,//签到序号
			allMatchUsers:null,//加了轮数的全部匹配
			actRound:0,//进入现场后经历了几轮环节
			isManage:false,//是否主持人
			//isFirstMatch:false,//输出一次无匹配信息
			curMatch:[],//已经公布的匹配
			prizeAll:null,//所有的中奖人对象
			prizeArr:["意中人","三等奖","四等奖","参与奖","二等奖","一等奖","三等奖","四等奖","参与奖","二等奖",],//奖品列表
			curResultMenu:["匹配结果","抽奖结果"],
			curResult:0,//主持人查看结果(1匹配,2抽奖)
			curNumber:null,//主持人查看结果当前的轮数
			curPrize:null,//主持人查看结果当前的抽奖
			prizeUser:null,//主持人查看的中奖人
			prizeUserList:[],//主持人查看的中奖人个数
			luckList:[],//单独抽奖用户列表(只有id)
			showLuck:false,//显示单独抽奖
			startLuck:false,//开始单独抽奖
			playingLuck:false,//单独抽奖是否正在进行
			luckuser:null,//单独抽奖的用户
			requestNum:0,//请求或接收消息的次数
			numberPeople:null,//每轮环节可选对象数
			
			isOpenInfo:false,//是否公开资料
			isInPrize:false,//是否进入奖池
			phListType:0,//排行列表显示的类型
			msgUser:null,//用来保存打开聊天窗口的用户信息的(会变动)
			showMsg:false,//是否显示聊天窗口
			msgTest:"",
			//manageMsg:["开始男生选择女生","开始女生选择男生","女生开始选择中意你的人","男生开始选择中意你的人","选择好了没有,开始匹配了"],//预定的主持人要说的话
			manageMsg:{},
			likePhList:[],//好感排行列表
			msgList:[],//所有的聊天信息
			ownerMsg:[],//私聊信息(根据id 不同)
			zhuchiMsg:[],//主持人发的信息
			userMsg:[],//用户发给主持人的
			userStyle:1,
			msgLength:{},
			notLoveList:[],//不是中意我的人
			taskList:[],//人气排行
			//newFanCount:0,//关注我
			//vistorCount:0,//查看我
			//beLikeCount:0,//好感
		}
    },
    components: {
      Loading,
	  Prize,
	  Back,
	  userInfo,
	  Popup,
	  gift,
	  XDialog,
	  draggable,
	  VoicePlayback,
	  Qrcode,
	  Luck,
      prizeDraw,
	// myPrize,
    },
	directives: {
      TransferDom
    },
	computed: {
		/*listenChatRoomMessageList() {//聊天信息
			return this.$store.state.chatRoomMessageList;
		},*/
		listenChatRoomFlower(){//礼物信息
			return this.$store.state.giftObj;
		},
		chatRoomInfoMsg() {//推送的信息
			return this.$store.state.chatRoomInfo;
		},
		myLoveLength(){
			return this.myLove.length;
		},
		handleRoute() {
			return this.$store.state.handleRoute;
		},
    },
    watch:{
		handleRoute(newV) {//返回键触发
			const t=this;
			if (!newV) {
				if(t.showWin){
					t.hiddenInfo();
				}else if(t.showSelect){
					t.showSelect=false;
				}else if(t.showPh){
					t.showPh=false;
				}
			}
		},
		listenChatRoomFlower(gift){
			//console.log("收到花:"+JSON.stringify(gift));
			const t=this;
			t.flower.putFlower(gift.userName,1,gift.userImage,gift.giftId,gift.giftImage);
		},
		/*listenChatRoomMessageList(newList){
			//消息列表，用于展示
			console.log('聊天室新消息：'+JSON.stringify(newList))
			this.chatList=newList;
			this.$nextTick(()=>{//滚动到底部
				//$(".jy_act_lt")[0].scrollTop=$(".jy_act_lt_list").outerHeight(true);
				$(".jy_act_lt").animate({"scrollTop":$(".jy_act_lt_list").outerHeight(true)},500);
			});
		},*/

		/*myLoveLength(val){
			const t=this;
			console.log("val:"+val)
			if(val>0){
				if(!t.baomingUser){
					t.getBaomingUser().then(()=>{
						let notLoveList=t.baomingUser.filter((v,i)=>{
							let has=t.myLove.filter((val,ind)=>{
								return v.jiaoyouUser.id==val.userId;
							});
							//console.log(has.length)
							return has.length<1;
						});
						t.notLoveList=notLoveList;
					});
				}else{
					let notLoveList=t.baomingUser.filter((v,i)=>{
						let has=t.myLove.filter((val,ind)=>{
							return v.jiaoyouUser.id==val.userId;
						});
						//console.log(has.length)
						return has.length<1;
					});
					t.notLoveList=notLoveList;
				}
				console.log("notLoveList:"+t.notLoveList.length)
			}
		},*/
		'chatRoomInfo.status': {//活动轮数状态改变
			handler(newVal, oldVal) {
				const t=this;
				if(newVal===oldVal){
					return false;
				}

			//	t.actRound++
				//console.log("经历的环节数:"+t.actRound);
				if(oldVal||oldVal==0){
					setTimeout(()=>{//延迟,为了isMatch等先判断完.
						
					},0);
				}	
			},
		},
		agreePrize(val){//是否已经提交了选择/是否已经同意加入奖池
			const t=this;
			if(val==1){
				t.isInPrize=true;
			}else{
				t.isInPrize=false;
			}
		},
		'chatRoomInfo.number': {//活动轮数改变
			handler(newVal, oldVal) {
				const t=this;
				if(newVal===oldVal){
					return false;
				}
				if(newVal!=5&&newVal!=6){
					t.showPrizeDraw=false;
				}else if(newVal!=7){
					t.showLuck=false;
				}
				setTimeout(async ()=>{//延迟,为了isMatch等先判断完.
					console.log("轮数改变:"+newVal+","+oldVal+" agreePrize:"+t.agreePrize);
					
				},0);
			},
			//deep: true//不需要,否则值相同也触发
		},
		'chatRoomInfo.state': {//活动轮数改变
			async handler(newVal, oldVal) {
				const t=this;
				if(newVal===oldVal){
					return false;
				}
				t.getBaomingUser();
			},
			//deep: true//不需要,否则值相同也触发
		},		
		currMatchUsers(val){//已匹配的人员列表
			const t=this;
			if(!t.isManage){//非主持,找出已经我已经匹配的.
				let hasMatch=val.filter(v=>{
					//return (v[0].userId==t.$store.state.userInfo.id||v[1].userId==t.$store.state.userInfo.id)&&v[0].status==1;
					return (v[0].userId==t.$store.state.userInfo.id||v[1].userId==t.$store.state.userInfo.id);
				});
				if(hasMatch.length>0){
					let myMathch=hasMatch[0].filter(v=>{
						return v.userId!=t.$store.state.userInfo.id;
					});
					t.myMathch=myMathch[0]||null;
					if(t.myMathch&&t.myMathch.status==1){//已经公布
						t.isMatch=true;
					}
					console.log("我的匹配:"+JSON.stringify(t.myMathch));
				}
			}
			console.log("匹配人数变化");
			let allMatchUsers=null;
			let sortVal=t.$utils.deepCopy(val);
			sortVal.sort((a,b)=>{
				return a[0].number>b[0].number;
			})
			for(let i =sortVal.length;i--;){
				let number=sortVal[i][0].number||sortVal[i][1].number;
				if(number&&(sortVal[i][0].status==1||t.isManage)){
					if(!allMatchUsers){
						allMatchUsers=[];
					}
					i/*f(!allMatchUsers["num_"+number]){
						if(!t.curNumber){
							t.curNumber="num_"+number;
						}
						allMatchUsers["num_"+number]=[];
					}
					allMatchUsers["num_"+number].push(sortVal[i]);*/
					allMatchUsers.push(sortVal[i]);
				}
			}
			console.log("allMatchUsers"+allMatchUsers)
			t.allMatchUsers=allMatchUsers;
			//$(".jy_act_bl_reslist").animate({"scrollTop":0},500);
		},
		'chatRoomInfo.allMatchUser': {//匹配人数变化
			handler(newVal, oldVal) {
				const t=this;
				let newMatch=null,oldMatch=null;
				if(newVal){
					newMatch=newVal.filter(v=>{
						return v[0].status==1;
					});
				}
				if(oldVal){
					oldMatch=oldVal.filter(v=>{
						return v[0].status==1;
					});
				}
				if(newMatch&&((oldMatch&&newMatch.length!=oldMatch.length)||!oldMatch||(t.isManage&&newVal.length!=oldVal.length))){
					t.curMatch=newMatch;
					t.currMatchUsers=newVal;
				}
			}
		},
		'chatRoomInfo.prizeUserList':{//(数值变化即开始新一轮抽奖)
			async handler(newVal,oldVal){
				const t=this;
				//console.log("prizeUserList")
				if(!oldVal||newVal.length>oldVal.length||!t.baomingUser){
					if(t.requestNum>1){//从第二次请求开始
						if(oldVal&&newVal.length>oldVal.length||(!oldVal&&newVal.length>0)){//开始抽奖
							t.luckList=t.chatRoomInfo.prizeUserList;//中奖者列表
							t.showLuck=true;
							t.startLuck=false;
							t.$nextTick(()=>{
								t.startLuck=true;
							});
						}
					}
					try{
						//console.log(t.baomingUser)
						if(!t.baomingUser){
							await t.getBaomingUser();
						}
						let luckuser=t.baomingUser.filter((val,ind)=>{//没抽中过的用户
							let canLuck=newVal.filter((v,i)=>{
								return val.jiaoyouUser.id==v;//已经抽过了.
							});
							return canLuck.length>0;//没抽过	 
						});
						//console.log("luckuser:"+luckuser);
						t.luckuser=luckuser;
					}catch(e){
						console.log(JSON.stringify(e));
					}
				}
			}
		},
		async isActEnd(val){
			const t=this;
			if(val){
				t.getBaomingUser();
			}
		},
		async prizeAll(val){
			const t=this;
			try{
				if(!t.baomingUser){
					await t.getBaomingUser();
				}
				let prizeUser={},prizeUserList=[];
				for(let i=t.baomingUser.length;i--;){
					if(val[t.baomingUser[i].jiaoyouUser.id]||val[t.baomingUser[i].jiaoyouUser.id]==0){
						if(!prizeUser[val[t.baomingUser[i].jiaoyouUser.id]]){
							prizeUser[val[t.baomingUser[i].jiaoyouUser.id]]=[];
							if(!t.curPrize){
								t.curPrize=val[t.baomingUser[i].jiaoyouUser.id];
							}
						}
						prizeUser[val[t.baomingUser[i].jiaoyouUser.id]].push(t.baomingUser[i]);
						prizeUserList.push(t.baomingUser[i]);
					}
				}
				t.prizeUser=prizeUser;
				t.prizeUserList=prizeUserList;
			}catch(e){
				console.log(JSON.stringify(e));
			}
		},
		async chatRoomInfoMsg(val){//活动信息更新(app使用)
			const t=this;
			t.requestNum++;
			t.chatRoomInfo=val;	
			if(!t.isSign&&val.status2){
				t.isSign=val.status2||false;//是否已经签到
				/*if(t.isSign){
					t.$vux.toast.show({
						type:"text",
						text: "您的序号为: "+t.isSign+" ,请牢记!",
						position:"middle",
						width:"auto",
						time:3000,
					});
				}*/
			}
			//t.actRound++
			//if(!t.isMatch){//还没匹配
				t.agreePrize=val.agreePrize;
			//}else{
			//	t.agreePrize=1;
			//}
			//console.log("agreePrize:"+t.agreePrize);
			if(val.beLikeList&&val.beLikeList.length>0&&(val.status==1||(val.number==2||val.number==3))){//中意我的人
				let myLove=val.beLikeList.filter((v,i)=>{
					let has=val.allMatchUser.filter((val,ind)=>{
						return val[0].userId==v.userId||val[1].userId==v.userId;
					});
					return has.length==0;
				});
				t.myLove=myLove;
				try{
					if(!t.baomingUser){
						await t.getBaomingUser();
					}
					let notLoveList=t.baomingUser.filter((v,i)=>{
						let has=t.myLove.filter((val,ind)=>{
							return v.jiaoyouUser.id==val.userId;
						});
						//console.log(has.length)
						return has.length<1;
					});
					t.notLoveList=notLoveList;
				}catch(e){
					console.log(JSON.stringify(e));
				}
			}else{
				t.myLove=[];
			}
			if(val.likeList&&val.likeList.length>0){//我中意的人
				t.youLove=val.likeList;
			}else{
				t.youLove=[];
			}
			if(val.state==5){//活动结束
				t.isActEnd=true;
			}
		},
		showWin(val){
			const t=this;
			let status = val || t.showSelect || t.showPh;
			t.$store.commit("CHANGEHANDLEROUTE", status);
			if(val){
				t.closeKeyBoard();
			}
		},
		showGift(val){
			const t=this;
			if(val){
				t.showPh=false;
			}
		},
		searchKey(){
			this.search(true);
		},
		showSelect(val){//个人信息
			const t=this;
			let status = val || t.showWin || t.showPh;
			t.$store.commit("CHANGEHANDLEROUTE", status);
		},
		msgList:{//信息变化
			handler(newVal,oldVal){
				const t=this;
				//if(!oldVal||newVal.length!=oldVal.length||t.showMsg){//数值有变化
					if(t.msgUser&&t.showMsg){//聊天窗口已经出现(私聊)
						let ownerMsg=newVal.filter((v,i)=>{
							return (v.userId==t.$store.state.userInfo.id&&v.receiverId==t.msgUser.userId)||(v.receiverId==t.$store.state.userInfo.id&&v.userId==t.msgUser.userId);
						});
					//	console.log(ownerMsg)
						t.ownerMsg=ownerMsg;
					}
					let zhuchiMsg=newVal.filter((v,i)=>{
						return !v.receiverId;
					});
					t.zhuchiMsg=zhuchiMsg;
					let userMsg=newVal.filter((v,i)=>{
						return v.receiverId==t.owner.jiaoyouUser.id;
					});
					t.userMsg=userMsg;
				if(oldVal&&newVal.length>oldVal.length){//长度变化
					let length=newVal.length;
					let dis=newVal.length-oldVal.length;
					for(let i=dis;i--;){
						if(newVal[length-1-i].receiverId==t.$store.state.userInfo.id){
							t.msgLength[newVal[length-1-i].userId]=true;
						}
					}
					
				}
			}
		},
		zhuchiMsg:{
			handler(newVal,oldVal){
				const t=this;
				if(t.requestNum>1&&(newVal.length>oldVal.length||(!oldVal&&newVal.length>0))&&!t.isManage){
					let length=newVal.length;
					t.$vux.toast.show({
						time:5000,
						type: 'text',
						text: "主持人:"+newVal[length-1].content,
						position: 'middle',
						width: 'auto',
					});
				}
			}
		},
		ownerMsg:{//私聊信息(窗口要弹出)
			handler(newVal,oldVal){
				const t=this;
				if(!oldVal||newVal.length!=oldVal.length){//数值有变化
					$(".jy_act_lt_list").animate({"scrollTop":1000000},500);
				}
			}
		},
		async showMsg(val){
			const t=this;
			if(val){
				//if(t.msgUser){
				//	t.getReceiverList();
				//}
				if(!t.isManage){
					t.getReceiverList();
				}
				t.showGiftUser=false;//送礼窗口
				t.msgLength[t.msgUser.userId]=false;
			}else{
				t.msgUser=null;
				t.ownerMsg=[];
			}
		},
		phListType(val){//排行榜列表类型
			const t=this;
			if(val==1){
				t.getLikeList();
			}else if(val==4){
				t.datingTaskRewardRanking();
			}
		},
		
    },
	beforeRouteLeave (to, from, next) {
		const t=this;	
		this.UIChatBox&&this.UIChatBox.close();
		if(!t.isExit&&this.datingId){
			this.$utils.openSuspensionWindow(this.datingId,this.owner.datingTitle,this.owner.coverimgImages||this.owner.jiaoyouUser.headimgAttachmentId,6);
		}
		//$(document).unbind("touchmove.blindDate");
		t.timeoutBlind&&clearTimeout(t.timeoutBlind);//清除定时器
		t.timeoutMsg&&clearTimeout(t.timeoutMsg);//清除定时器
		next();
    },
	created(){
		const t=this;
	},
    async mounted(){
		const t=this;
		t.$utils.closeSuspensionWindow();
		//$(document).bind("touchmove.blindDate",t.touchHandlerDummy);
		t.datingId = t.$route.query.id;
		if(!t.datingId){
			t.$vux.toast.show({
				type: 'cancel',
				text: "活动不存在",
				position: 'middle',
				width: 'auto',
			});
			return false;
		}
		//t.signCode={type:"signIn",from:"blindDate",id:t.datingId};
		//if(t.$store.state.isBrowser){
			t.signCode= t.$store.state.baseURL+"/api/account/publicAddressLoginUrl?&state=sign__id_"+t.datingId;//签到二维码
		//}
		console.log("活动ID:"+t.datingId);
		let goon=true;
		try{
			await t.getSingle();//获取活动详情
		}catch(e){
			goon=false;
		}
		if(!goon){
			return false;
		}
		t.flower=new myApi(function(gift){
			t.giftAniEnd(gift)
		});
		//t.newFanCount=t.$store.state.userInfo.userExt.newFanCount;
		//t.vistorCount=t.$store.state.userInfo.userExt.vistorCount;
		//t.beLikeCount=t.$store.state.userInfo.userExt.beLikeCount;
		
		t.phListType=4;
		t.getGift();//获取礼物列表
		t.getManageMsg();
		//t.getConfig();//获取配置文件
		//t.clickMusic="static/music/tips5.aac?ver=1.02";
		//t.longMusic="static/music/tips6.mp3?ver=1.02";
		//t.musicClick=new Media({src:t.clickMusic,loop:false,autoplay:false});//点击音乐
		//t.musicLong=new Media({src:t.longMusic,loop:false,autoplay:false});//长音乐
		if(!t.owner){
			return false;
		}
		//t.audioAutoPlay();
		//if(!t.isManage){//非主持人才能滑屏
			let myClickTouch=new myTouch({//滑屏
				wrapper:".jy_act_blind",
				durationTime:0.3,
				loop:false,//横屏是否循环滚动
				mouse:true,//竖屏是否支持鼠标滚轮滚动
				disRadio:0,//触发翻屏所需要的最小拖动距离比例
				preventDefault:true,
				horizontalClassName:".horizontalScroll_1",//水平页面顶级容器 (必须是 verticalPageName 的一代子元素)
				contentClassName:".contentScroll_1",//滚动内容的容器(必须是 verticalPageName 的一代子元素)
				verticalPageName:".page_1",//垂直页面容器 (必须是 wrapper 的一代子元素)
				horizontalPageName:".page_2",//水平页面容器(必须是 horizontalClassName 的一代子元素)
				curClassName:"cur",//当前页面
				start:function(){
					//console.log("start");
				},
				moveY:function(d){
					//console.log("moveY"+this.changeY);
				},
				endY:function(){
					//console.log("endY");
				},
				moveX:function(d){
					//console.log("moveX"+this.changeX);
					t.closeKeyBoard();
					$(".jy_s1_jt").removeClass("cur");
				},
				endX:function(){
					//console.log("endX");
				},
			});
			$(".jy_s1_jt").addClass("cur");
		//}
		t.getBaomingUser();
		//if(!window.api){
			//t.actStatus();//获取活动状态
			//if(t.$store.state.isBrowser){
			//for(let i=500;i--;){
				(function getDatingStatus(time){
					//if(t.isActEnd){//活动结束后不再请求
					//	return false;
					//}
					//clearTimeout(t.timeoutBlind);
					t.timeoutBlind=setTimeout(async ()=>{
						try{
							const result =await t.$server.actStatus({
								datingDetailsId:t.datingId,
							});
							if(t.$route.name!="blindDateNew"){//预防跳出路由后还会执行
								return false;
							}
							let val=result.data.data;
							//console.log("定时器请求数据:"+JSON.stringify(val));
							t.$store.commit('CHAGECHATROOMINFO',val);//更新现场活动信息	
							//t.chatRoomInfo=val;
							getDatingStatus(2500);
						}catch(e){
							if(t.$route.name!="blindDateNew"){//预防跳出路由后还会执行
								return false;
							}
							getDatingStatus(2500);
						}
					},time);
				}(0));		
		//	}
				
				(function getMsg(time){//获取聊天信息的
					clearTimeout(t.timeoutMsg);
					return false;
					t.timeoutMsg=setTimeout(async ()=>{
						try{
							const result =await t.$server.getReceiverList({
								datingId:t.datingId,
								//userId:t.msgUser.userId||t.msgUser.jiaoyouUser.id,
								rows:100000,
							});
							if(t.$route.name!="blindDateNew"){//预防跳出路由后还会执行
								return false;
							}
							t.msgList=result.data.list;
							getMsg(t.showMsg?1000:4000);
						}catch(e){
							if(t.$route.name!="blindDateNew"){//预防跳出路由后还会执行
								return false;
							}
							getMsg(t.showMsg?1000:4000);
						}
					},time);
				}(1000));
			//}
			return false;
	//	}
		//this.joinChatRoom();
      this.UIChatBox = window.api.require('UIChatBox');
	  let extras={},extrasBtn={};
      this.UIChatBox.open({
        placeholder: '',
        maxRows: 4,
        emotionPath: 'widget://image/emotion',
        texts: {
          sendBtn: {
            title: '发送'
          }
        },
        styles: {
          inputBar: {
            borderColor: '#d9d9d9',
            bgColor: '#f2f2f2'
          },
          inputBox: {
            borderColor: '#B3B3B3',
            bgColor: '#FFFFFF'
          },
          emotionBtn: {
            normalImg: 'widget://image/face.png',
          },
		  ...extrasBtn,
          keyboardBtn: {                      //JSON对象；键盘按钮样式
            normalImg: 'widget://image/keyboard.png'
          },
          indicator: {
            target: 'both',
            color: '#c4c4c4',
            activeColor: '#9e9e9e'
          },
          sendBtn: {
            titleColor: '#4cc518',
            bg: '#f2f2f2',
            activeBg: '#46a91e',
            titleSize: 14
          }
        },
		...extras,
      }, function(ret, err) {
        if(ret.eventType=="send"){
          if(!ret.msg.trim()){
            return false;
          }
         t.setMessage(2,ret.msg,null,null,null)
        }else if(ret.eventType=='clickExtras'){
          if(ret.index==0){
            t.closeKeyBoard();
            t.showGift=true;
          }
        }
      });
	  /*监听事件*/
		this.UIChatBox.addEventListener({
			target: 'inputBar',
			name: 'move'
		}, (ret, err)=> {
			if (ret) {
				const height=ret.panelHeight;
				clearTimeout(t.boardTimeout);
				if(height==0){
					t.boardTimeout=setTimeout(()=>{
						t.closeKeyBoard();
					},200);
				}
			}
		});
		if(!t.isManage){
			this.UIChatBox.addEventListener({
				target: 'inputBar',
				name: 'showExtras'
			}, (ret, err)=> {
				if (ret) {
					t.closeKeyBoard();
					t.showGift=true;

				}
			});
		}
		this.UIChatBox.addEventListener({
			target: 'inputBar',
			name: 'change'
		}, (ret, err)=> {
			if (ret) {
				this.inputBarHeight = parseInt(ret.inputBarHeight);
			}
		});
		t.closeKeyBoard();
	},
    beforeDestroy () {
      this.quitChatRoom();
    },
    methods :{
      toLink(){
        this.showPrizeDraw = true;
        return ;
        this.$router.push({
          path: "/prizeDraw/main",
          query:{
            id:this.datingId
          }
        })
      },
	  prizeTip(){
		alert('允许后,对方可能会在抽奖中跟您匹配成功');
	  },
	  
		async datingTaskRewardRanking(){
			const t=this;
			try{
				const result = await t.$server.datingTaskRewardRanking({
					datingId:t.datingId
				});
				t.taskList=result.data.data;
			}catch(e){
				console.log(JSON.stringify(e));
			}
		},
		async getManageMsg(){
			const t=this;
			try{
				const result = await t.$server.apiDict({type:"question_master_talk"});
				t.manageMsg=result.data.data;
			}catch(e){
				console.log(JSON.stringify(e));
			}
		},
		async getLikeList(){//获取好感排行
			const t=this;
			try{
				t.isloading=true;
				const result =await t.$server.getLikeList({
					datingId:t.datingId,
					rows:10000
				});
				t.isloading=false;
				//console.log(result.data.data)
				t.likePhList=result.data.data;
			}catch(e){
				t.isloading=false;
				e.message&&t.$vux.toast.show({
					type:"cancel",
					text: e.message,
					position:"middle",
					width:"2rem",
				});
			}
		},
		getBaomingUserIndex(id){//获取报名用户的数组下标
			const t=this;
			let length=t.baomingUser.length;
			let index=null;
			for(let i=length;i--;){
				if(id==t.baomingUser[i].jiaoyouUser.id){
					index=i;
					break;
				}
			}
			return index;
		},
		async sendMessage(){//发送私聊留言
			const t=this;
			if(t.msgTest!=''){
				try{
					const result= await t.$server.sendMessage({
						datingId:t.datingId,
						receiverId:t.msgUser.userId,
						content:t.msgTest,
					});
					t.msgTest='';
				}catch(e){
					console.log(JSON.stringify(e));
				}
			}else{
				t.$vux.toast.show({
					type:"text",
					text: "内容不能为空",
					position:"bottom",
					width:"2rem",
				});
			}
		},
		async sendBroad(content){//发送广播留言
			const t=this;
			if(t.msgTest!=''||content){
				try{
					const result= await t.$server.sendBroad({
						datingId:t.datingId,
						//receiverId,
						content:content||t.msgTest,
					});
					!content?t.msgTest='':'';
					t.$vux.toast.show({
						type:"success",
						text: "广播成功",
						position:"middle",
						width:"2rem",
					});
				}catch(e){
					console.log(JSON.stringify(e));
				}
			}else{
				t.$vux.toast.show({
					type:"text",
					text: "内容不能为空",
					position:"bottom",
					width:"2rem",
				});
			}
		},
		async getReceiverList(){//获取留言信息
			const t=this;
			try{
				t.isloading=true;
				const result =await t.$server.getReceiverList({
					datingId:t.datingId,
					//userId:t.msgUser&&t.msgUser.userId,
					rows:100000,
				});
				t.isloading=false;
				t.msgList=result.data.list;
			}catch(e){
				t.isloading=false;
				console.log("获取留言信息出错:"+JSON.stringify(e));
			}			
		},
		async userRefresh(){//刷新
			const t=this;
			t.getBaomingUser();//报名用户
			t.getReceiverList();//留言信息
			t.getLikeList();//好感排行
			t.datingTaskRewardRanking();//人气排行
			try{
				let userInfo = await t.$server.getUserInfo({userId:t.$store.state.userInfo.id});
				//t.newFanCount=userInfo.data.data.userExt.newFanCount;
				//t.vistorCount=userInfo.data.data.userExt.vistorCount;
				//t.beLikeCount=userInfo.data.data.userExt.beLikeCount;
				t.$store.commit("LOGIN",userInfo.data.data);
			}catch(e){
				console.log(JSON.stringify(e));
			}
		},
		async getBaomingUser(){//获取报名用户
			const t=this;
			try{
				const result= await t.$server.blindDatingBaoming({
					datingId:t.datingId,
					rows:10000
				});
				let baomingUser=result.data.list||[];
				baomingUser.sort((a,b)=>{
					if(t.$store.state.userInfo.sex==2){
						return a.candidateSex-b.candidateSex;
					}else{
						return b.candidateSex-a.candidateSex;
					}
				});
				t.baomingUser=baomingUser;
				return Promise.resolve(baomingUser);
			}catch(e){
				console.log(JSON.stringify(e));
				return Promise.reject(e);
			}
			
		},
		async publishMatch(user){
			const t=this;
			t.$vux.confirm.show({
				title:"公布结果",
				content:"确定公布此匹配吗?",
				maskZIndex:98,
				onCancel(){
						
				},
				async onConfirm(){
					let arr=[];
					arr.push({
						datingActivityId:t.datingId,
						userId:user[0].userId,
						likingUserId:user[1].userId,
					})
					try{
						const result =await t.$server.publishMatch(arr);
					}catch(e){
						e.message&&t.$vux.toast.show({
							type:"cancel",
							text: e.message,
							position:"middle",
							width:"2rem",
						});
					}
				}
			});
		},
		async cancelLike(index){//后悔了
			const t=this;
			let user=t.baomingUser[index].jiaoyouUser;
			try{
				t.isloading=true;
				const result =await t.$server.cancelLike({
					datingActivityId:t.datingId,
					likingUserId:user.id,
				});
				t.isloading=false;
				user.isLike=0;
				if(t.selectUserInfo){
					t.selectUserInfo.isLike=0;
				}
			}catch(e){
				t.isloading=false;
				e.message&&t.$vux.toast.show({
					type:"cancel",
					text: e.message,
					position:"middle",
					width:"2rem",
				});
			}
		},
		async saveSingleLike(index){//保存单个意中人
			const t=this;
			let user=t.baomingUser[index].jiaoyouUser;
			if(user.isLike==3||user.isLike==1){
				t.cancelLike(index);//取消意中人
			}else{
				try{
					t.isloading=true;
					const result =await t.$server.saveSingleLike({
						datingActivityId:t.datingId,
						likingUserId:user.id,
					});
					t.isloading=false;
					user.isLike=3;
				}catch(e){
					t.isloading=false;
					e.message&&t.$vux.toast.show({
						type:"cancel",
						text: e.message,
						position:"middle",
						width:"2rem",
					});
				}
			}
		},
		/**
			number:1 双向配 2 男求配 3 女求配
			status:1 推女方/推男方  2双向配/男求配/女求配
		**/
		async datingStepButton(number,status,flag){//取消保存中意的用户
			const t=this;
			t.$vux.confirm.show({
				title:"温馨提示",
				content:"确定进行此操作吗",
				maskZIndex:98,
				onCancel(){
						
				},
				async onConfirm(){
					try{
						const result =await t.$server.datingStepButton({
							activityId:t.datingId,
							number:number,
							status:status,
							flag:flag||"",
						});
						t.$store.commit('CHAGECHATROOMINFO',result.data.data);//更新现场活动信息	
						if(result.data.data.state==5){//活动结束
							t.isActEnd=true;
						}
					}catch(e){
						console.log(JSON.stringify(e));
					}
				}
			});
		},
		closeLuck(){
			this.showLuck=false;
		},
		endLuck(){
			this.startLuck=false;
		},
		moveLuck(moveing){
			this.playingLuck=moveing
		},
		prizeResult(result){
			const t=this;
			t.$store.commit('CHAGECHATROOMINFO',result);//更新现场活动信息	
		},
		getSex(sex){
			if(sex==1){
				return "女";
			}else if(sex==2){
				return "男";
			}
			return "";
		},
		getResult(id){
			const t=this;
			if(t.isManage||id==t.$store.state.userInfo.id){
				if(t.isManage&&t.currMatchUsers.length>0){
					let hasResult=t.currMatchUsers.filter((v,i)=>{
						return (v[0].userId==id||v[1].userId==id);
					});
					//console.log(hasResult)
					if(hasResult.length>0){
						return "已匹配"+(hasResult[0].status==0?'(未公布)':'');
					}
				}
				if(t.prizeAll&&(t.prizeAll[id]||t.prizeAll[id]==0)){//下标可以为0
					return t.prizeArr[t.prizeAll[id]];
				}
			}
			return "";
		},
		clickVoice(flag){
			const t=this;
			if(flag){
				if(t.musicClick){
					t.musicClick.pause();
				}
				if(t.musicLong&&t.musicLong.media){
					t.musicLong.media.currentTime=0;
					t.musicLong.play();
				}
			}else{
				if(t.musicLong){
					t.musicLong.pause();
				}
				if(t.musicClick&&t.musicClick.media){
					t.musicClick.media.currentTime=0;
					t.musicClick.play();
				}
			}
			
		},
		audioAutoPlay(){  
			const t=this;
			var play = function(){
				if(!t.musicClick||!t.musicClick.media){
					t.musicClick=new Media({src:t.clickMusic,loop:false,autoplay:false});//点击音乐		
				}
				if(!t.musicLong||!t.musicLong.media){
					t.musicLong=new Media({src:t.longMusic,loop:false,autoplay:false});//长音乐		
				}
				if(t.musicClick.loading&&t.musicLong.loading){	
					document.removeEventListener("touchstart",play, false);  
				}else{
					if(!t.musicClick.loading){
						t.musicClick.onload();
					}
					if(!t.musicLong.loading){
						t.musicLong.onload();
					}
				}
			};
			document.addEventListener("WeixinJSBridgeReady", function () {  
				play();  
			}, false);  
			document.addEventListener('YixinJSBridgeReady', function() {  
				play();  
			}, false);  
			document.addEventListener("touchstart",play, false);  
		},
		touchHandlerDummy(e){
			const t=this;
			e.preventDefault();
			return false;
		},
		exit(name,query){
			const t=this;
			t.isExit=true;
			t.$router.push({name,query});
		},
		async toOpen(type){
			const t=this;
			try{
				let data={
					datingActivityId:t.datingId,
					extInt5:t.isInPrize?0:1
				}
				if(type==2){
					data={
						datingActivityId:t.datingId,
						extInt7:t.isOpenInfo?0:1
					}
				}
				t.isloading=true;
				const result=await t.$server.saveCandidateExt(data);
				if(type==2){
					t.isOpenInfo=!t.isOpenInfo;
				}else{
					t.isInPrize=!t.isInPrize;
				}
				t.isloading=false;
			}catch(e){
				t.isloading=false;
				e.message&&t.$vux.toast.show({
					type: 'cancel',
					text: e.message,
					position: 'middle',
					width: 'auto',
				});
			}
		},
		async followFriend(){ //关注好友接口
			const t=this;
			try{
				t.isloading=true;
				const result = await t.$server.followFriend(t.selectUserInfo.id);
				t.isloading=false;
				/*t.$vux.toast.show({
					type: 'success',
					text: result.data.message,
					position: 'middle',
					width: 'auto',
				});*/
				t.selectUserInfo.isFollow=1;
			}catch(e){
				t.isloading=false;
				t.$vux.toast.show({
					type: 'cancel',
					text: e.message,
					position: 'middle',
					width: 'auto',
				});
			}
		},
		async unfollowFriend(){ //关注好友接口
			const t=this;
			try{
				t.isloading=true;
				const result = await t.$server.unfollowFriend(t.selectUserInfo.id);
				t.isloading=false;
				/*t.$vux.toast.show({
					type: 'success',
					text: result.data.message,
					position: 'middle',
					width: 'auto',
				});*/
				t.selectUserInfo.isFollow=0;
			}catch(e){
				t.isloading=false;
				t.$vux.toast.show({
					type: 'cancel',
					text: e.message,
					position: 'middle',
					width: 'auto',
				});
			}
		},
		async showSelectUser(id,extInt){//显示中意的人的信息
			const t=this;
			//console.log(id);
			try{
				t.isloading=true;
				const result =await t.$server.userHomePage({
					userId:id,
					activityId:t.datingId,
				});
				t.selectUserInfo=result.data.data;
				if(extInt){
					t.selectUserInfo.extInt=extInt;
				}
				console.log("中意的人:"+JSON.stringify(t.selectUserInfo));
				t.isloading=false;
				t.showSelect=true;
			}catch(e){
				t.isloading=false;
				console.log(JSON.stringify(e));
			}
		},
		async getGood(){//我好感的人
			const t=this;
			try{
				const result =await t.$server.getGood2({
					datingActivityId:t.datingId,
				});
				if(result.data.list){
					t.loveList=result.data.list;
				}
			}catch(e){
				console.log(JSON.stringify(e));
			}
		},
		async myFeel(index){//好感
			const t=this;
			if(index===''){
			console.log("ddddd:"+index)
				index=t.getBaomingUserIndex(t.selectUserInfo.id);
			}
			let user=t.baomingUser[index].jiaoyouUser;
			if(user.isGood){
				try{
					t.isloading=true;
					const result =await t.$server.deleteGood2({
						datingActivityId:t.datingId,
						likingUserId:user.id,
					});
					//t.showSelect=false;
					t.isloading=false;
					/*t.$vux.toast.show({
						type:"success",
						text: result.data.message,
						position:"middle",
						width:"2rem",
					});*/
					user.isGood=0;
					if(t.selectUserInfo){
						t.selectUserInfo.isGood=0;
					}
				}catch(e){
					t.isloading=false;
					t.$vux.toast.show({
						type:"cancel",
						text: e.message,
						position:"middle",
						width:"2rem",
					});
				}
			}else{
				try{
					t.isloading=true;
					const result =await t.$server.addGood2({
						datingActivityId:t.datingId,
						likingUserId:user.id,
					});
					//t.showSelect=false;
					t.isloading=false;
					/*t.$vux.toast.show({
						type:"success",
						text: result.data.message,
						position:"middle",
						width:"2rem",
					});*/
					user.isGood=1;
					if(t.selectUserInfo){
						t.selectUserInfo.isGood=1;
					}
				}catch(e){
					t.isloading=false;
					t.$vux.toast.show({
						type:"cancel",
						text: e.message,
						position:"middle",
						width:"2rem",
					});
				}
			}	
		},
		async marriageAgree(){//同意选择对方
			const t=this;
			t.$vux.confirm.show({
				title:"接受Ta",
				content:"确认接受对方?",
				maskZIndex:98,
				onCancel(){
					t.$vux.toast.show({
						type:"text",
						text: "再等等看看",
						position:"bottom",
						width:"2rem",
					});		
				},
				async onConfirm(){
					try{
						t.isloading=true;
						const result =await t.$server.marriageAgree2({
							datingActivityId:t.datingId,
							likingUserId:t.selectUserInfo.id,
						});
						//t.showSelect=false;
						t.isloading=false;
						if(t.selectUserInfo){
							t.selectUserInfo.isLike=1;
						}
						/*t.myMathch={
							extInt:t.selectUserInfo.extInt,//序号
							headimg:t.selectUserInfo.headimgAttachmentId,//头像
							name:t.selectUserInfo.aliasName,//昵称
							number:t.chatRoomInfo.number,//轮数
							status:0,//是否公布
							userId:t.selectUserInfo.id,//用户id
							sex:t.selectUserInfo.sex,
						}*/
						/*t.$vux.toast.show({
							type:"success",
							text: "已接受",
							position:"middle",
							width:"2rem",
						});		*/
					}catch(e){
						t.isloading=false;
						t.$vux.toast.show({
							type:"cancel",
							text: e.message,
							position:"middle",
							width:"2rem",
						});	
					}
				}
			});
		},
		search(flag){
			const t=this;

			if(t.searchKey!=''){
				let searchList=t.baomingUser.filter((v,i)=>{//元素为对象时,传递的是地址
					return (v.ext&&v.ext.extInt==t.searchKey)||v.jiaoyouUser.aliasName.indexOf(t.searchKey)!=-1||(v.jiaoyouUser.age==t.searchKey);
				});
				searchList.sort((a,b)=>{
					if(t.$store.state.userInfo.sex==2){
						return a.candidateSex-b.candidateSex;
					}else{
						return b.candidateSex-a.candidateSex;
					}
				})
				t.searchList=searchList;
				//console.log(flag);
				if(!flag){
					$(".jy_bl_Choose_search input").blur();
				}
				t.listType=2;
			}else{
				t.searchList=[];
				/*t.$vux.toast.show({
					type:"text",
					text: "请输入序号或昵称",
					position:"bottom",
					width:"2rem",
				});*/
			}
		},
		dragEnd:function(evt){
          /*console.log('拖动前的索引：'+evt.oldIndex);
          console.log('拖动后的索引：'+evt.newIndex);
          console.log(this.chooseList);*/
        },
		delChoose(index){
			const t=this;
			for(let i=t.selectList.length;i--;){
				if(t.chooseList[index].id==t.selectList[i].id){
					t.selectList[i].choose=false;
					break;
				}
			}
			t.chooseList.splice(index,1);
		},
		choose(index){
			const t=this;
			if(t.listType==1){
				for(let i=t.selectList.length;i--;){
					if(t.loveList[index].id==t.selectList[i].id){
						index=i;
						break;
					}
				}
			}else if(t.listType==2){
				for(let i=t.selectList.length;i--;){
					if(t.searchList[index].id==t.selectList[i].id){
						index=i;
						break;
					}
				}
			}
			if(!t.selectList[index].choose){
				if(t.chooseList.length<t.chooseMax){
					t.selectList[index].choose=true;
					t.chooseList.push(t.selectList[index])
				}else{
					t.$vux.toast.show({
						type:"text",
						text: "最多选择"+t.chooseMax+"位对象",
						position:"bottom",
						width:"2rem",
					});
				}
			}else{
				t.selectList[index].choose=false;
				let chooseList=t.chooseList.filter(v=>{
					return v.id!=t.selectList[index].id;
				});
				t.chooseList=chooseList;
			}
		},
		setActiveItem(item){
			this.activeItem = this.activeItem.id==item.id?{}:item;
		},
      listenChildMethod(){
        this.activeItem={};
      },
      touchstart(event){
        if(event.touches.length>1){
          return;
        }
        this.record=true
        this.showVedio=true
        this.touchY = event.touches[0].clientY;
        this.touchOffset=0;
        window.api.startRecord({
          path: api.cacheDir+"/"+new Date().getTime()+"-"+this.$store.state.userId+".amr"
        });
        setTimeout(()=>{
          if(this.showVedio){
            window.api.stopRecord((ret, err)=> {
              if (ret) {
                let path = ret.path;
                let duration = ret.duration;
                this.setAudio(path,duration)
              }
            });
            this.record=false
            this.showVedio=false;
          }
        },30000)
        event.preventDefault();
      },
      touchmove(event){
        let offsetY = Math.abs(event.touches[0].clientY-this.touchY)
        let offset = offsetY;
        if(offset>this.touchOffset)this.touchOffset=offset;
      },
      touchend(event){
        if(event.touches.length>1){
          return;
        }
        if(this.touchOffset<30){
          if(this.showVedio){
            window.api.stopRecord((ret, err)=> {
              if (ret) {
                let path = ret.path;
                let duration = ret.duration;
                this.setAudio(path,duration)
              }
            });
            this.showVedio=false
            this.record=false
          }
        }else{
          //
          if(this.showVedio){
            window.api.stopRecord(function(ret, err) {
            });
            this.showVedio=false;
            this.record=false
          }
        }
      },
      touchcancel(){
        console.log("touchcancel")
        if(this.showVedio){
          window.api.stopRecord(function(ret, err) {
          });
          this.showVedio=false;
          this.record=false
        }
      },
      setAudio(path,duration){
        if(duration<1){
          this.$vux.toast.show({
            type:"text",
            text: '语音时长太短',
            position:"middle",
            width:"auto",
          });
          return;
        }
        this.setMessage(2,null,null,path,null,duration)
      },
      beginRecord(){
        this.voice=!this.voice;
        let allowRecording=false;
        let resultList = window.api.hasPermission({
          list:['microphone']
        });
        if(!resultList[0].granted){
          window.api.requestPermission({
            list:['microphone']
          }, function(ret, err){
            if(ret&&ret.list[0].granted){
              allowRecording=true;
            }else{
              window.api.toast({
                msg: '请在手机设置中授权应用访问麦克风',
                duration: 2000,
                location: 'bottom'
              });
              this.voice=!this.voice;
            }
          });
        }
      },
		showKeyBoard(){
			const t=this;
			if(!t.UIChatBox){
				return false;
			}
			t.showBoard=true;
			t.showPh=false;
			t.UIChatBox.show();
			t.UIChatBox.popupKeyboard();
		},
		closeKeyBoard(){
			const t=this;
			if(!t.UIChatBox){
				return false;
			}
			t.showBoard=false;
			t.UIChatBox.hide();
			t.UIChatBox.closeBoard();
			t.UIChatBox.closeKeyboard();
		},
		getUserInfo(userId){
			const t=this;
			if(userId==t.$store.state.userInfo.id){
				return false;
			}
			//console.log("获取用户信息:"+userId);
			t.showInfo=true;
			t.userId=userId;
		},
		prizeRunning(val){//抽奖转盘是否在转动
			const t=this;
			t.prizeRun=val;	
		},
		toStartPrize(){
			const t=this;
			t.startPrize=true;
			clearInterval(t.prizeTimeout);
		},
		endPrize(index){//抽奖结束
			const t=this;
			const msg=t.prizeArr[index];//index==0?'意中人':(index==1||index==6)?'三等奖':(index==2||index==7)?'四等奖':(index==3||index==8)?'参与奖':(index==4||index==9)?'二等奖':index==5?'一等奖':'';
			if(msg){
				t.$vux.toast.show({
					type:"text",
					text: "恭喜获得 "+msg,
					position:"bottom",
					width:"2rem",
				});
			}
			setTimeout(()=>{
				t.showZy=false;//隐藏抽奖奖盘
			},1500);
		},
		giftAniEnd(gift){//把礼物发到服务器
			const t=this;
			if(gift){
				console.log("连点结束:"+JSON.stringify(gift));
				if(gift.sendobj){//自己发的
					try{
						t.$server.chartroomGift({
							"objectId":t.datingId,
							giftId:gift.sendobj.giftId,
							amount:gift.num
						}).then((res)=>{
							console.log("送花结果:"+JSON.stringify(res));				
						});
					}catch(e){
						console.log(e);
					}	
				}
			}	
		},
		async sendGiftUser(giftObj){
			const t=this;
			if(giftObj){
				t.showGiftUser=false;
				try{
					const result =await t.$server.giveGift({
						'receiverUser.id':t.selectUserInfo.id,
						objectId:t.datingId,
						giftId:giftObj.id,
						amount:1,
					});
					t.$vux.toast.show({
						type:"success",
						text: result.data.message,
						position:"middle",
						width:"2rem",
					});
					//t.showGiftUser=false;
				}catch(e){
					t.$vux.toast.show({
						type:"cancel",
						text: e.message,
						position:"middle",
						width:"2rem",
					});
				}
			}else{
				t.showGiftUser=false;
			}
		},
		async sendGift(giftObj){
			if(giftObj){
				this.giftEndlist.push(giftObj);
			  let sendobj={};
			  sendobj.giftId = giftObj.id
			  sendobj.giftImage = this.$utils.getFullPath(giftObj.giftImage)
			  sendobj.giftName = giftObj.giftName
			  sendobj.giftJiaobi = giftObj.jiaobi
			  sendobj.userName=this.$store.state.userInfo.aliasName;
			  sendobj.userId=this.$store.state.userInfo.id;
			  sendobj.userImage=this.$utils.getFullPath(this.$store.state.userInfo.headimgAttachmentId);
			  this.flower.putFlower(sendobj.userName,1,sendobj.userImage,sendobj.giftId,sendobj.giftImage,sendobj);
			  this.$store.state.rongCloud.sendCommandMessage({
				conversationType: 'CHATROOM',
				targetId: this.datingId,
				name: 'gift',
				data: JSON.stringify(sendobj)
			  },(ret, err)=> {
				if (ret.status == 'prepare') {
				  console.log(JSON.stringify(ret.result.message));
				}else if (ret.status == 'success') {
				  console.log(ret.result.message.messageId);
				  //this.saveMessage(1,null,null,null,null,'','[送出礼物]',ret.result.message.messageId,null,null,sendobj)
				}else if (ret.status == 'error'){
				  let remark='发送失败';
				  if(err.code=='30014'){
					remark='发送处理失败'
				  }else if(err.code=='31009'){
					remark='您被对方屏蔽'
				  }else if(err.code=='405'){
					remark='您被对方加入黑名单'
				  }
				  console.log(JSON.stringify(err))
				 // this.saveMessage(1,null,null,null,null,remark,'[送出礼物]',new Date().getTime(),null,null,sendobj)
				}
			  })
			}else{
				this.showGift=false;
			}
		},
		async getGift(){
			try{
				let list = await this.$server.getGiftList()
				this.giftList = list.data.data||[];
			}catch(e){
				console.log(JSON.stringify(e));
			}
		},
		openWin(){
			//console.log("openwin")
			const t=this;
			//t.showPh=false;
			
			t.showWin=true;
		},
      hiddenPrizeDraw(){
        this.showPrizeDraw=false;
      },
		hiddenInfo(){
			this.showWin=false;
			setTimeout(()=>{
				this.showInfo=false;
			},800)
		},
		async getSingle(){//获取活动详情
			const t=this;
			try{
				//console.log("ddddddddddddddddddd");
				const result =await t.$server.blindDatingSingle({
					datingDetailsId:t.datingId
				});
				t.owner=result.data.data;
				if(t.owner.jiaoyouUser.id==t.$store.state.userInfo.id){
					t.isManage=true;
				}
				if(t.owner.isCandidate==0&&!t.isManage){//没报名(不是群主)
					t.$router.replace({name:"activityDetail",query:{id:t.datingId}});
					t.$vux.toast.show({
						type:"cancel",
						text: "请先报名!",
						position:"middle",
						width:"auto",
					});
					return Promise.reject({message:"请先报名"});
				}
				if(t.owner.config){
					t.numberPeople=[t.owner.config.oneLikeCount||5,t.owner.config.twoLikeCount||1,t.owner.config.threeLikeCount||1];//没个环节的可选对象数量
				}
					
				t.title=t.owner.jiaoyouUser.aliasName;
				if(window.api){
					t.$db. updateActiveState(t.datingId,t.$store.state.userId,t.owner.state)
					t.$store.dispatch("getConversationList")
				}
				//console.log("活动详情:"+JSON.stringify(result.data));
			}catch(e){
				console.log(e);
			}
		},
		getExpContent(content){
			const t=this;
			let imgArr2=content.match(/\[.+?\]/g);
			if(imgArr2){
				imgArr2.map(item1=>{
					emotion.map(emo=>{
						if(emo.text==item1){
							content = content.replace(item1,'<img class="imgcontent" src="static/emotion/'+emo.name+'.png"/>');
						}
					})
				})
			}
			return content;
		},
		setMessage(type,text,imgUrl,audio,location,duration){
			const _t = this;
			//发送消息
			const tp = type==1?"PRIVATE":type==2?"GROUP":type==3?"CHATROOM":type==4?"DISCUSSION":"SYSTEM ";//1单聊2群组3聊天室4讨论组5系统
			let sendObj={}
			if(text){
			  sendObj={
				conversationType: tp,
				targetId: _t.datingId,
				text: text,
				extra: '',
				actType:6,
			  }
			  this.$store.state.rongCloud.sendTextMessage(sendObj, function(ret, err) {
				if (ret.status == 'prepare') {
				  console.log("prepare:",{msg: JSON.stringify(ret.result.message)});
				}else if (ret.status == 'success') {
				  console.log("success:",{msg: ret.result.message.messageId});
				  _t.saveMessage(type,text,imgUrl,audio,location,'',text,ret.result.message.messageId,null,null)
				}else if (ret.status == 'error'){
				  let remark='发送失败';
				  if(err.code=='30014'){
					remark='发送处理失败'
				  }else if(err.code=='31009'){
					remark='您被对方屏蔽'
				  }else if(err.code=='405'){
					remark='您被对方加入黑名单'
				  }
				  console.log("remark:",remark)
				  _t.saveMessage(type,text,imgUrl,audio,location,remark,text,new Date().getTime(),null,null)
				}
			  });
			}else if(audio){
			  sendObj={
				conversationType: tp,
				targetId: _t.datingId,
				voicePath: audio,
				duration: duration,
				extra: '',
				actType:6,
			  }
			  this.$store.state.rongCloud.sendVoiceMessage(sendObj, function(ret, err) {
				console.log(JSON.stringify(ret));
				console.log(JSON.stringify(err));
				if (ret.status == 'prepare') {
				  console.log(JSON.stringify(ret.result.message));
				}else if (ret.status == 'success') {
				  console.log(ret.result.message.messageId+"rrrrrrrrrrrrrrrrrrr");
				  _t.saveMessage(type,text,imgUrl,audio,location,duration,'[语音]',ret.result.message.messageId,null,null)
				}else if (ret.status == 'error'){
				  let remark='发送失败';
				  if(err.code=='30014'){
					remark='发送处理失败'
				  }else if(err.code=='31009'){
					remark='您被对方屏蔽'
				  }else if(err.code=='405'){
					remark='您被对方加入黑名单'
				  }else if(err.code=='22406'){
					remark='您不是群成员'
				  }
				  _t.saveMessage(type,text,imgUrl,audio,location,remark,'[语音]',new Date().getTime(),null,null)
				}
			  });
			}
		},
    saveMessage(type,text,imgUrl,audio,location,status,tip,messageId,lon,lat){//保存消息到本地
        let _t= this;
        let remark = status;
       //
        let icon=this.owner.coverimgImages?this.owner.coverimgImages:this.owner.jiaoyouUser.headimgAttachmentId;
        let name=this.owner.datingTitle;
        let activeType=this.owner.activityMethod
        _t.$db.insertOrUpdateUnreadCountName(_t.datingId,type,icon,name,1,tip,new Date().getTime(),messageId,_t.$store.state.userId,_t.$store.state.userId,this.owner.state,activeType)
        _t.$db.insertConversation(_t.datingId,type,(_t.$store.state.userInfo.headimgAttachmentId),_t.$store.state.userInfo.aliasName,_t.$store.state.userId,text,new Date().getTime(),remark,_t.$store.state.userId,location,imgUrl,audio,messageId,lon,lat)
		
        _t.getNewMessageList();
        _t.$store.dispatch("getConversationList")
      },
	  getNewMessageList(status){
        let _t = this;
        const dataChats=this.$db.getConversation(this.datingId,this.$store.state.userId,this.limit);
        this.$db.resetCount(this.datingId,this.$store.state.userId);
		_t.$store.commit('CHANGECHATROOMMESSAGELIST',dataChats)
		_t.$nextTick(()=>{//滚动到底部
			$(".jy_act_lt").animate({"scrollTop":$(".jy_act_lt_list").outerHeight(true)},500);
		})
      },
     joinChatRoom(){
		const t=this;
		t.isloading=true;
      this.$store.commit('CHANGECURRENTCHATROOMID',this.datingId)
	  this.getNewMessageList();
	  if(!this.$store.state.rongCloud){
		console.log("融云初始化失败");
		t.isloading=false;
		return false;
	  }
      this.$store.state.rongCloud.joinChatRoom({
        chatRoomId: this.datingId,
        defMessageCount: -1
      }, async (ret, err)=> {
		//alert(ret.status)
        if (ret.status == 'success'){
        //  api.toast({ msg: JSON.stringify(ret.status) });
          this.$store.state.rongCloud.setConversationNotificationStatus({
            conversationType: 'CHATROOM',
            targetId: this.datingId,
            notificationStatus: 'DO_NOT_DISTURB'
          }, function(ret, err) {
            console.log('设置免打扰结果：'+JSON.stringify(ret))
          })
		  
			 try{
				 await t.actStatus();//获取活动状态
			 }catch(e){
				console.log("获取活动状态"+JSON.stringify(e));
			}
			t.isloading=false;
        } else
			t.isloading=false;
			
         // api.toast({ msg: err.code });
      })
    },
    quitChatRoom(){
		const t=this;
		this.$store.commit('CHANGECURRENTCHATROOMID',null);
		this.$store.commit('CHANGECHATROOMMESSAGELIST',[]);//清空聊天记录
		this.$store.state.rongCloud&&this.$store.state.rongCloud.quitChatRoom({
			chatRoomId: this.datingId
		},async function(ret, err) {
			if (ret.status == 'success'){
				api.toast({ msg: "离开活动现场" });
				try{
					const result=await t.$server.actLeave({
						datingDetailsId:t.datingId,
					});
					
				}catch(e){
					console.log(JSON.stringify(e));
				}
			}else{
				api.toast({ msg: err.code });
			}
				
		})
    },
		async actStatus(){//获取活动状态
			const t=this;
			try{
				console.log("开始请求活动状态");
				let	result = await t.$server.actStatus({
					datingDetailsId:t.datingId
				});
				console.log("请求活动状态成功:"+JSON.stringify(result.data));
				t.$store.commit('CHAGECHATROOMINFO',result.data.data);//更新现场活动信息	
				if(result.data.data.state==5){//活动结束
					t.isActEnd=true;
					//t.actStatusRes=true;//不显示结果弹窗
				}
			}catch(e){
				console.log(JSON.stringify(e));
			}
		},
		qcode(){
			const t=this;
			if(t.isManage){//主持人
				t.showQcode=true;
				return false;
			}
			const api=window.api||"";
			if(api){
				const FNScanner = api.require('FNScanner');
				FNScanner.openScanner({
					autorotation: true//扫描页面是否自动旋转
				}, async function(ret, err) {
					//console.log(JSON.stringify(ret));
					if (ret) {
						if(ret.eventType=="success"){
							let param=t.Fn.toWxUrl(ret.content);
							if(param.name=="sign"&&param.query.id){//签到
								try{
									const result =await t.$server.blindDateSignIn({
										datingActivityId:param.query.id
									});
									//console.log("签到成功:"+JSON.stringify(result.data));
									t.isSign=result.data.data.ext.extInt;
									alert("签到成功,您的序号为:"+result.data.data.ext.extInt);
									
									/*
									t.$vux.toast.show({
										type:"success",
										text: result.data.message,
										position:"middle",
										width:"auto",
									});*/
								}catch(e){
									t.$vux.toast.show({
										type:"cancel",
										text: e.message,
										position:"middle",
										width:"auto",
									});
								}
							}else if(ret.content.indexOf('http://')==0  || ret.content.indexOf('https://')==0){
								alert("连接:"+ret.content);
							}else if(ret.content.indexOf('type')!=-1&&ret.content.indexOf('from')!=-1){//旧版的app内签到
								let data=JSON.parse(ret.content);
								if(data.type=="signIn"&&data.from=='blindDateNew'){//相亲签到
									try{
										const result =await t.$server.blindDateSignIn({
											datingActivityId:data.id
										});
										//console.log("签到成功:"+JSON.stringify(result.data));
										alert("签到成功,您的序号为:"+result.data.data.ext.extInt);
										/*
										t.$vux.toast.show({
											type:"success",
											text: result.data.message,
											position:"middle",
											width:"auto",
										});*/
									}catch(e){
										t.$vux.toast.show({
											type:"cancel",
											text: e.message,
											position:"middle",
											width:"auto",
										});
									}
								}
							}else{
								alert(ret.content);
							}
						}else if(ret.eventType=="cameraError"){
							t.$vux.toast.show({
								type:"cancel",
								text: "访问摄像头失败",
								position:"middle",
								width:"auto",
							})
						}else if(ret.eventType=="albumError"){
							t.$vux.toast.show({
								type:"cancel",
								text: "访问相册失败",
								position:"middle",
								width:"auto",
							})
						}else if(ret.eventType=="fail"){
							t.$vux.toast.show({
								type:"cancel",
								text: "扫码失败",
								position:"middle",
								width:"auto",
							});
						}
					} else {
						alert(JSON.stringify(err));
					}
				});
			}else if(t.$store.state.isWeixin){
				scanQRCode&&scanQRCode();
			}else{
				t.$vux.toast.show({
					type:"cancel",
					text: "当前设备不支持该功能",
					position:"middle",
					width:"auto",
				});
			}
		},
    }
  }
</script>
<style lang="scss" scoped>
  .jy_lt_right{
    .jy_lt_msg{
      position: relative;
      .remark{
        position: absolute;
		width:100%;
		text-align:right;
		right:100%;
		margin-right:0.1rem;
        bottom: 0;
        font-size: 0.3rem;
        color:#fff;
      }
    }
  }
  .jy_lt_left{
    .jy_lt_msg{
      position: relative;
      .remark{
        position: absolute;
        left:100%;
		width:100%;
		margin-left:0.1rem;
        bottom: 0;
        font-size: 0.3rem;
        color:#fff;
      }
    }
  }
  .vedio-cls{
    position: absolute;
    z-index: 10;
    left: 0;
    top:0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.6);
    div{
      text-align: center;
      color: #FFF;
    }
    div:first-child{
      display: inline-block;
      margin-left: 50%;
      width: 200px;
      height: 80px;
      transform:translateX(-50%);
      margin-top: 70%;
      position:relative;
      span{
        width:5px;
        height: 5px;
        bottom:20px;
        position:absolute;
        background:#46a91e;
        animation: bodong 0.5s infinite  ease;
      }

      span:first-child{
        left:83.5px;
        animation-delay:.3s;
      }

      span:nth-child(2){
        left:90.5px;
        animation-delay:.4s;

      }
      span:nth-child(3){
        left:97.5px;
        animation-delay:.6s;
      }
      span:nth-child(4){
        left:104.5px;
        animation-delay:.8s;
      }
      span:nth-child(5){
        left:111.5px;
        animation-delay:1s;
      }

      @keyframes bodong{
        0%{height:5px; }
        30%{height:15px; }
        60%{height:20px; }
        80%{height:15px; }
        100%{height:5px; }
      }
    }
  }
</style>
